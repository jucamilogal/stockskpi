<!doctype html>
{% load humanize %}
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Finboard — P/E Ranking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --card:#fff; --border:#e9ecef; --shadow:0 1px 4px rgba(0,0,0,.06); --blue:#1f7aed; }
    * { box-sizing:border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:24px; color:#111827; }
    a { color: var(--blue); text-decoration:none; }
    header { display:flex; align-items:center; gap:16px; margin-bottom:14px; }
    nav a { margin-right:12px; opacity:.8 } nav a:hover { opacity:1 }
    h1 { margin:0; font-size:24px; font-weight:700; }
    .row { display:flex; flex-wrap:wrap; gap:12px; align-items:center; }
    .controls { gap:12px; margin:12px 0 18px; }
    input, select, button { padding:8px 10px; border-radius:8px; border:1px solid var(--border); background:#fff; }
    button { cursor:pointer; border-color:var(--blue); background:var(--blue); color:#fff; box-shadow:var(--shadow); }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:14px; }
    table { width:100%; border-collapse: collapse; }
    th, td { padding:10px 12px; border-bottom:1px solid var(--border); text-align:left; font-size:14px; }
    th { background:#f8fafc; font-weight:600; }
    .right { text-align:right; }
    .muted { color:#6b7280; }
    @media (max-width:760px){ .row{flex-direction:column; align-items:stretch;} }
  </style>
</head>
<body>
  <header>
    <h1>P/E Ranking</h1>
    <nav class="muted">
      <a href="/">Dashboard</a>
      <a href="/screener/">Screener</a>
    </nav>
  </header>

  <!-- Filtros (GET) -->
  <form method="get" class="row controls" action="">
    <label>Sector:</label>
    <input name="sector" list="sectors" placeholder="e.g. Technology" value="{{ selected_sector|default:'' }}">
    <datalist id="sectors">
      {% for s in sectors %}
        <option value="{{ s }}"></option>
      {% endfor %}
    </datalist>

    <label>Min MarketCap (USD):</label>
    <input name="min_mcap" type="number" step="1" placeholder="e.g. 10000000000" style="width:220px" value="{{ min_mcap|default:'' }}">
    <button type="submit">Filtrar</button>
  </form>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th style="width:70px;">#</th>
          <th style="width:110px;">Ticker</th>
          <th>Name</th>
          <th style="width:160px;">Sector</th>
          <th class="right">MarketCap</th>
          <th class="right">P/E (TTM)</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td><a href="/?ticker={{ r.ticker }}">{{ r.ticker }}</a></td>
            <td>{{ r.name|default:"" }}</td>
            <td>{{ r.sector|default:"" }}</td>
            <td class="right">
              {% if r.marketcap %}${{ r.marketcap|floatformat:0|intcomma }}{% else %}—{% endif %}
            </td>
            <td class="right">
              {% if r.pe_ttm != None %}{{ r.pe_ttm|floatformat:2 }}{% else %}—{% endif %}
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6" class="muted">No results</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <p class="muted" style="margin-top:8px;">{{ rows|length }} results</p>
  </div>
</body>
</html>
